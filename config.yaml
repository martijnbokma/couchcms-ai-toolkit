# CouchCMS AI Toolkit - Consolidated Configuration
# This file consolidates settings from defaults.yaml, smart-defaults.yaml, and preflight-checks.yaml
# Version: 2.0
#
# Schema Documentation:
# - All paths are relative to project root (no leading /)
# - Naming conventions must be one of: snake_case, camelCase, PascalCase, kebab-case
# - Severity levels: CRITICAL, ERROR, WARNING, INFO
# - File patterns use glob syntax (*, **, ?)

# =============================================================================
# PROJECT SETTINGS
# =============================================================================
# Basic project information and configuration
#
# Schema:
#   name: string - Project identifier (kebab-case recommended)
#   description: string - Human-readable project description
#   type: string - Project type (e.g., "CouchCMS Web Application")

project:
  name: "my-project"
  description: "My CouchCMS project"
  type: "CouchCMS Web Application"

# =============================================================================
# TOOLKIT LOCATION
# =============================================================================
# Path to the toolkit directory (relative to project root)
#
# Schema:
#   path: string - Relative path to toolkit (e.g., "./ai-toolkit-shared" or ".")

toolkit:
  path: "./ai-toolkit-shared"

# =============================================================================
# EDITOR SUPPORT
# =============================================================================
# List of AI editors to generate configurations for
#
# Supported editors:
#   - cursor: Cursor IDE (.cursorrules)
#   - claude: Claude Code (.claude/)
#   - windsurf: Windsurf (.windsurf/rules.md)
#   - kiro: Kiro (.kiro/steering/)
#   - copilot: GitHub Copilot (.github/copilot-instructions.md)
#
# Schema: array<string> - List of editor identifiers

editors:
  - cursor
  - claude
  - windsurf
  - kiro
  - copilot

# =============================================================================
# MODULES
# =============================================================================
# Knowledge modules to load (CouchCMS features and frameworks)
#
# Available modules:
#   Core: couchcms-core
#   Frontend: tailwindcss, daisyui, alpinejs, typescript
#   Backend: databound-forms, custom-routes
#   Content: folders, archives, relationships, repeatable-regions, search, pagination, comments
#   User: users
#
# Schema: array<string> - List of module names

modules:
  - couchcms-core
  - tailwindcss
  - alpinejs

# =============================================================================
# AGENTS
# =============================================================================
# Specialized AI agents for development tasks
#
# Available agents:
#   Core: couchcms, databound-forms, custom-routes
#   Frontend: alpinejs, tailwindcss, typescript
#   Content: views, folders, archives, relationships, repeatable-regions, search, pagination, comments
#   User: users
#   Development: bun, git, mysql
#
# Schema: array<string> - List of agent names

agents:
  - couchcms
  - tailwindcss
  - alpinejs

# =============================================================================
# FRAMEWORK (AAPF)
# =============================================================================
# Autonomous Agent Prompting Framework configuration
#
# Options:
#   - false: Disabled (default)
#   - true: Full framework (doctrine + directives + playbooks + enhancements)
#   - object: Custom selection with boolean flags
#
# Schema: boolean | object
#   doctrine: boolean - Core operational principles
#   directives: boolean - Specific instructions
#   playbooks: boolean - Step-by-step procedures
#   enhancements: boolean - Additional capabilities

framework: false
# OR:
# framework:
#   doctrine: true
#   directives: true
#   playbooks: true
#   enhancements: false

# =============================================================================
# PROJECT PATHS
# =============================================================================
# Directory paths for project organization
#
# Schema: object<string, string> - Key-value pairs of path identifiers to relative paths
# All paths are relative to project root (no leading /)

paths:
  # Frontend assets
  css: "assets/css"
  typescript: "assets/ts"
  javascript: "assets/js"
  images: "assets/images"
  fonts: "assets/fonts"

  # CouchCMS templates
  snippets: "snippets"
  components: "snippets/components"
  views: "snippets/views"
  layouts: "snippets/layouts"
  filters: "snippets/filters"
  forms: "snippets/forms"
  helpers: "snippets/helpers"

  # Build output
  public: "public"
  dist: "dist"

  # Configuration
  config: "config"
  scripts: "scripts"

# =============================================================================
# CODING STANDARDS
# =============================================================================
# Core coding standards applied to all generated code
#
# Schema:
#   indentation: integer (1-8) - Number of spaces for indentation
#   language: string - Must be "english" (enforced by toolkit)
#   lineLength: integer (80-200) - Maximum line length in characters

standards:
  indentation: 4
  language: "english"
  lineLength: 120

# =============================================================================
# NAMING CONVENTIONS
# =============================================================================
# Naming style conventions for different code elements
#
# Valid values: snake_case, camelCase, PascalCase, kebab-case
#
# Schema: object<string, string> - Key-value pairs of element types to naming conventions

naming:
  # PHP/CouchCMS
  php_variables: "snake_case"
  php_functions: "snake_case"
  cms_fields: "snake_case"

  # TypeScript/JavaScript
  ts_variables: "camelCase"
  ts_functions: "camelCase"
  ts_classes: "PascalCase"
  ts_interfaces: "PascalCase"
  ts_types: "PascalCase"

  # CSS
  css_classes: "kebab-case"
  css_variables: "kebab-case"

  # Files
  php_files: "kebab-case"
  ts_files: "kebab-case"
  css_files: "kebab-case"
  component_files: "kebab-case"

# =============================================================================
# GIT WORKFLOW (GITFLOW)
# =============================================================================
# Configuration for the Gitflow branching model
#
# Schema:
#   branches: object - Branch name configuration
#   patterns: object - Branch naming patterns (prefixes)
#   stale_days: integer - Days before branch is considered stale
#   auto_delete: boolean - Auto-delete merged branches
#   require_pr: boolean - Require pull requests for merges

gitflow:
  branches:
    main: "main"
    develop: "develop"
  patterns:
    feature: "feature/"
    release: "release/"
    hotfix: "hotfix/"
  stale_days: 30
  auto_delete: true
  require_pr: true

# =============================================================================
# FILE CONTEXTS
# =============================================================================
# Automatic context loading based on file type and location
#
# Schema: object<string, object> - Glob pattern → context configuration
#   agents: array<string> - List of agent names to activate
#   modules: array<string> - List of module names to load

file_contexts:
  "*.php":
    agents: [couchcms]
    modules: [couchcms-core]

  "*.ts":
    agents: [typescript]
    modules: [typescript]

  "*.js":
    agents: [typescript]
    modules: [typescript]

  "snippets/components/*.html":
    agents: [couchcms, alpinejs]
    modules: [couchcms-core, alpinejs]

  "snippets/views/**/*.html":
    agents: [couchcms]
    modules: [couchcms-core]

  "snippets/forms/*.html":
    agents: [databound-forms, couchcms]
    modules: [databound-forms, couchcms-core]

  "snippets/filters/*.html":
    agents: [couchcms]
    modules: [couchcms-core]

  "snippets/layouts/*.html":
    agents: [couchcms, tailwindcss]
    modules: [couchcms-core, tailwindcss, daisyui]

  "assets/css/**/*.css":
    agents: [tailwindcss]
    modules: [tailwindcss, daisyui]

  "config/*.php":
    agents: [couchcms]
    modules: [couchcms-core]

# =============================================================================
# TEMPLATE ALIASES
# =============================================================================
# Short names for template paths used in code generation
#
# Schema: object<string, string> - Alias → template path
# Paths are relative to toolkit root

template_aliases:
  # Component templates
  component-basic: "templates/components/basic.html"
  component-alpine: "templates/components/alpine.html"
  component-card: "templates/components/card.html"
  component-modal: "templates/components/modal.html"

  # View templates
  view-list: "templates/views/list.html"
  view-detail: "templates/views/detail.html"
  view-edit: "templates/views/edit.html"

  # Form templates
  form-basic: "templates/forms/basic.html"
  form-wizard: "templates/forms/wizard.html"
  form-validated: "templates/forms/validated.html"

  # Filter templates
  filter-basic: "templates/filters/basic.html"
  filter-authenticated: "templates/filters/authenticated.html"
  filter-ownership: "templates/filters/ownership.html"
  filter-admin: "templates/filters/admin.html"

# =============================================================================
# VALIDATION RULES
# =============================================================================
# Pre-flight checks and validation rules
#
# Schema:
#   required_modules: array<string> - Modules that must be loaded
#   max_line_length: integer - Maximum allowed line length
#   enforce_english: boolean - Enforce English-only code
#   checks: object - Validation check configurations

validation:
  required_modules: [couchcms-core]
  max_line_length: 200
  enforce_english: true

  # Pre-flight checks by category
  checks:
    # CouchCMS-specific checks
    couchcms:
      html_comment_security:
        pattern: "<!--[\\s\\S]*?<cms:[\\s\\S]*?-->"
        severity: CRITICAL
        message: "CouchCMS tags inside HTML comments are EXECUTED! This can cause crashes."
        fix: "Replace <cms: with [cms: inside HTML comments"

      paired_else_tags:
        pattern: "<cms:else\\s*>\\s*</cms:else>|<cms:else_if[^/]*>\\s*</cms:else_if>"
        severity: ERROR
        message: "<cms:else> and <cms:else_if> must be self-closing tags"
        fix: "Use <cms:else /> instead of <cms:else></cms:else>"

    # TypeScript checks
    typescript:
      any_type:
        pattern: ":\\s*any\\b"
        severity: WARNING
        message: "Avoid 'any' type - it defeats TypeScript's type safety"
        fix: "Define a specific type or interface"

      console_log:
        pattern: "console\\.(log|debug|info)\\("
        severity: INFO
        message: "console.log detected - consider removing for production"
        fix: "Remove console.log or use a proper logging utility"

    # Security checks
    security:
      xss_innerhtml:
        pattern: "\\.innerHTML\\s*=(?!.*sanitize|.*escape)"
        severity: CRITICAL
        message: "Potential XSS vulnerability - innerHTML with unsanitized content"
        fix: "Use textContent for plain text, or escape/sanitize HTML content"

      eval_usage:
        pattern: "\\beval\\s*\\("
        severity: CRITICAL
        message: "eval() is a security risk and should be avoided"
        fix: "Use alternative approach - JSON.parse() for JSON"

      hardcoded_credentials:
        pattern: "(password|secret|api_key|apikey|token)\\s*=\\s*['\"][^'\"]{8,}['\"]"
        severity: CRITICAL
        message: "Potential hardcoded credentials detected"
        fix: "Use environment variables or secure configuration"

    # Alpine.js checks
    alpinejs:
      missing_xcloak:
        pattern: "x-show\\s*=(?![\\s\\S]*x-cloak)"
        severity: INFO
        message: "Element with x-show may flash on page load without x-cloak"
        fix: "Add x-cloak attribute to prevent FOUC"

  # Execution configuration
  execution:
    block_on: [CRITICAL, ERROR]
    warn_on: [WARNING]
    inform_on: [INFO]
    global_ignore:
      - "node_modules/**"
      - "vendor/**"
      - "dist/**"
      - ".git/**"
      - "*.min.js"
      - "*.min.css"
