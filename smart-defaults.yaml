# CouchCMS AI Toolkit - Smart Defaults Configuration
# Automatic context loading and suggestions based on file type and location

# =============================================================================
# FILE TYPE CONTEXTS
# =============================================================================
# When a file is referenced, automatically load the appropriate agents/modules

file_contexts:
  # PHP Templates (CouchCMS)
  "*.php":
    agents: [couchcms]
    modules: [couchcms-core]
    checks: [html-comment-security, template-structure]
    suggestions:
      - extract-to-snippet
      - add-caching
      - check-authentication

  # TypeScript Files
  "*.ts":
    agents: [typescript]
    modules: [typescript]
    checks: [type-safety, no-any]
    suggestions:
      - add-types
      - extract-interface
      - add-jsdoc

  # JavaScript Files
  "*.js":
    agents: [typescript]
    modules: [typescript]
    checks: [deprecated-patterns]
    suggestions:
      - convert-to-typescript

  # CouchCMS Snippets - Components
  "snippets/components/*.html":
    agents: [couchcms, alpinejs]
    modules: [couchcms-core, alpinejs]
    checks: [alpine-integration, component-structure]
    suggestions:
      - add-alpine-state
      - extract-css
      - add-documentation

  # CouchCMS Snippets - Views
  "snippets/views/**/*.html":
    agents: [couchcms]
    modules: [couchcms-core]
    checks: [view-structure, seo-tags]
    suggestions:
      - add-pagination
      - add-filtering

  # CouchCMS Snippets - Forms
  "snippets/forms/*.html":
    agents: [databound-forms, couchcms]
    modules: [databound-forms, couchcms-core]
    checks: [csrf, validation, ownership]
    suggestions:
      - add-error-handling
      - add-success-message

  # CouchCMS Snippets - Filters
  "snippets/filters/*.html":
    agents: [couchcms]
    modules: [couchcms-core]
    checks: [security-filter]
    suggestions:
      - add-logging
      - add-flash-message

  # CouchCMS Layouts
  "snippets/layouts/*.html":
    agents: [couchcms, tailwindcss]
    modules: [couchcms-core, tailwindcss, daisyui]
    checks: [layout-structure, accessibility]
    suggestions:
      - add-skip-link
      - check-meta-tags

  # CSS Files
  "assets/css/**/*.css":
    agents: [tailwindcss]
    modules: [tailwindcss, daisyui]
    checks: [css-quality]
    suggestions:
      - convert-to-tailwind
      - use-css-variables

  # Config Files
  "config/*.php":
    agents: [couchcms]
    modules: [couchcms-core]
    checks: [config-security]
    suggestions:
      - use-environment-vars

# =============================================================================
# ACTION CONTEXTS
# =============================================================================
# Default configurations for creation commands

action_contexts:
  # Create Component Bundle
  create_component:
    files:
      - path: "{{paths.components}}/{{name}}.html"
        template: component-basic
      - path: "{{paths.css}}/components/{{name}}.css"
        template: css-component
        optional: true
      - path: "{{paths.typescript}}/components/{{name}}.ts"
        template: ts-component
        optional: true
    post_actions:
      - register-in-index
      - update-imports
    variations:
      --alpine:
        template_override: component-alpine
        add_module: alpinejs
      --card:
        template_override: component-card
      --modal:
        template_override: component-modal

  # Create View
  create_view:
    files:
      - path: "{{paths.views}}/{{name}}/list.html"
        template: view-list
      - path: "{{paths.views}}/{{name}}/detail.html"
        template: view-detail
      - path: "{{paths.views}}/{{name}}/edit.html"
        template: view-edit
        optional: true
    post_actions:
      - register-routes
    variations:
      --list-only:
        files: [list.html]
      --crud:
        files: [list.html, detail.html, edit.html, create.html, delete.html]

  # Create Form
  create_form:
    files:
      - path: "{{paths.forms}}/{{name}}.html"
        template: form-basic
    post_actions:
      - add-validation
      - add-csrf
    variations:
      --wizard:
        template_override: form-wizard
      --validated:
        template_override: form-validated

  # Create API Endpoint
  create_api:
    files:
      - path: "api/{{name}}.php"
        template: api-json
    post_actions:
      - register-route
    variations:
      --rest:
        template_override: api-rest
      --graphql:
        template_override: api-graphql

  # Create Filter
  create_filter:
    files:
      - path: "{{paths.filters}}/{{name}}.html"
        template: filter-basic
    variations:
      --auth:
        template_override: filter-authenticated
      --owner:
        template_override: filter-ownership
      --admin:
        template_override: filter-admin

# =============================================================================
# INTENT PATTERNS
# =============================================================================
# Automatic detection of user intent from natural language

intent_patterns:
  # Bug Fix Intent
  fix:
    triggers:
      - "fix"
      - "repair"
      - "broken"
      - "not working"
      - "error"
      - "bug"
    action: diagnose_and_fix
    confirm: "I'll identify and fix issues in the file(s). Proceed?"

  # Refactor Intent
  refactor:
    triggers:
      - "refactor"
      - "improve"
      - "clean up"
      - "restructure"
    action: activate_refactor_router
    confirm: "I'll analyze for refactoring opportunities. Proceed?"

  # Code Review Intent
  review:
    triggers:
      - "review"
      - "check"
      - "analyze"
      - "look at"
    action: code_review
    confirm: false  # No confirmation needed for read-only

  # Creation Intent
  create:
    triggers:
      - "create"
      - "make"
      - "new"
      - "add"
      - "generate"
    action: create_resource
    extract: resource_type  # Extract what type to create

  # Explanation Intent
  explain:
    triggers:
      - "why"
      - "how does"
      - "what does"
      - "explain"
      - "understand"
    action: explain_code
    confirm: false

  # Optimization Intent
  optimize:
    triggers:
      - "optimize"
      - "speed up"
      - "performance"
      - "faster"
      - "improve performance"
    action: performance_analysis
    confirm: "I'll analyze for performance improvements. Proceed?"

# =============================================================================
# COMMUNICATION MODES
# =============================================================================

communication_modes:
  quick:
    description: "Minimal output, maximum efficiency"
    confirmations: false
    explanations: minimal
    suggestions: compact
    format: inline

  standard:
    description: "Balanced interaction"
    confirmations: significant_only
    explanations: brief
    suggestions: structured
    format: blocks

  verbose:
    description: "Detailed explanations for learning"
    confirmations: all
    explanations: full
    suggestions: detailed
    format: expanded
    include_references: true

# =============================================================================
# SUGGESTION TRIGGERS
# =============================================================================

suggestion_triggers:
  # After fixing a bug
  after_fix:
    - check: has_similar_issues
      suggest: "Fix similar issues in {count} other files?"
    - check: missing_test
      suggest: "Add regression test?"
    - check: missing_documentation
      suggest: "Update documentation?"

  # After creating a component
  after_create_component:
    - suggest: "Register in component index?"
    - suggest: "Create usage example?"
    - check: has_css
      suggest: "Extract styles to CSS file?"

  # After refactoring
  after_refactor:
    - check: similar_patterns
      suggest: "Apply same refactoring to {count} similar files?"
    - check: consumers_exist
      suggest: "Update {count} files using this component?"

  # After modifying shared code
  after_modify_shared:
    - check: has_consumers
      suggest: "Verify {count} consumers still work?"
    - check: has_tests
      suggest: "Run related tests?"

# =============================================================================
# PROJECT CONTEXT STRUCTURE
# =============================================================================
# Expected structure for .project/context-cache.json

context_cache_schema:
  lastUpdated: "ISO8601 timestamp"
  projectStructure:
    templates: ["list of template files"]
    components: ["list of component files"]
    views: ["list of view files"]
    typescript: ["list of TypeScript files"]
  dependencies:
    cms: "CouchCMS version"
    css: "CSS framework and version"
    js: "JavaScript framework and version"
  patterns:
    authentication: "path to auth pattern"
    ownership: "path to ownership pattern"
    pagination: "path to pagination pattern"
  recentChanges:
    - file: "filename"
      type: "modified|created|deleted"
      date: "ISO8601 timestamp"
  conventions:
    namingStyle: "kebab-case|snake_case|camelCase"
    indentation: 4
    language: "english"

# =============================================================================
# TEMPLATE ALIASES
# =============================================================================

template_aliases:
  # Component templates
  component-basic: "templates/components/basic.html"
  component-alpine: "templates/components/alpine.html"
  component-card: "templates/components/card.html"
  component-modal: "templates/components/modal.html"

  # View templates
  view-list: "templates/views/list.html"
  view-detail: "templates/views/detail.html"
  view-edit: "templates/views/edit.html"
  view-crud: "templates/views/crud-bundle"

  # Form templates
  form-basic: "templates/forms/basic.html"
  form-wizard: "templates/forms/wizard.html"
  form-validated: "templates/forms/validated.html"

  # Filter templates
  filter-basic: "templates/filters/basic.html"
  filter-authenticated: "templates/filters/authenticated.html"
  filter-ownership: "templates/filters/ownership.html"
  filter-admin: "templates/filters/admin.html"

  # API templates
  api-json: "templates/api/json.php"
  api-rest: "templates/api/rest.php"

  # CSS templates
  css-component: "templates/css/component.css"
