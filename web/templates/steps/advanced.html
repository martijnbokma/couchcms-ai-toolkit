<div>
    {% set sectionTitle = 'Advanced Options' %}
    {% set sectionDescription = 'Optional advanced configuration options for experienced users. These settings affect how AI agents behave and where context files are stored.' %}
    {% include "partials/section-header.html" %}

    <form hx-post="/api/setup/step/advanced" hx-target="#wizard-content" hx-swap="innerHTML" onsubmit="return handleAdvancedSubmit(event)" aria-label="Advanced options configuration form">
        {% include "partials/hidden-fields.html" %}

        {# CADS (CouchCMS AI Development Standards) Framework Section #}
        <fieldset class="relative flex flex-col h-full px-3 sm:px-4 py-3 sm:py-4 bg-base-200 shadow-sm border border-base-300 rounded-xl mb-3 sm:mb-4">
            <legend class="sr-only">CADS Framework Configuration</legend>
            <div class="w-full">
                <h3 class="flex items-center gap-2 text-base sm:text-lg font-semibold mb-2 sm:mb-3 text-base-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                    <span class="flex-1">CADS Framework</span>
                    <span class="text-xs sm:text-sm text-base-content/60 font-normal">(CouchCMS AI Development Standards)</span>
                    <button type="button" id="cads-info-toggle" onclick="toggleInfo('cads-info', this)" class="btn btn-circle btn-xs sm:btn-sm btn-ghost text-info hover:bg-info/10 tooltip tooltip-left flex items-center justify-center shrink-0 cursor-pointer" data-tip="More information about CADS Framework" aria-label="Show more information about CADS Framework" aria-expanded="false" aria-controls="cads-info">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-4 h-4 sm:w-5 sm:h-5" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </button>
                </h3>

                <div id="cads-info" class="mb-3 sm:mb-4 hidden" role="region" aria-labelledby="cads-info-heading">
                    <h4 id="cads-info-heading" class="text-sm sm:text-base font-semibold mb-2 text-base-content">What is CADS?</h4>
                    <p class="text-xs sm:text-sm text-base-content/80 leading-relaxed">CADS (CouchCMS AI Development Standards) provides structured and predictable behavior for AI agents working on CouchCMS projects. It includes doctrine (core principles), directives (communication guidelines), playbooks (workflow templates), and enhancements (advanced features) specifically tailored for CouchCMS development.</p>
                </div>

                <p class="text-xs sm:text-sm text-base-content/70 mb-3 sm:mb-4">Enable CADS for more structured and predictable AI agent behavior. This is especially useful for complex CouchCMS projects where consistency and adherence to CouchCMS patterns is important.</p>

                <div class="form-control">
                    <label class="label cursor-pointer justify-start gap-4">
                        <input type="checkbox" name="framework" value="true" id="framework-checkbox" class="checkbox checkbox-primary rounded-xl" {% if framework %}checked{% endif %} onchange="updateFrameworkVisibility()" aria-describedby="framework-description" />
                        <span class="label-text font-medium text-base-content">Enable CADS Framework</span>
                    </label>
                    <span id="framework-description" class="sr-only">Enables structured AI agent behavior for CouchCMS projects</span>
                </div>

                <div id="framework-options" class="mt-3 sm:mt-4 {% if not framework %}hidden{% endif %}" role="group" aria-labelledby="framework-components-heading">
                    <p id="framework-components-heading" class="text-xs sm:text-sm font-medium mb-2 sm:mb-3 text-base-content">Framework Components:</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3">
                        <label class="label cursor-pointer justify-start gap-3 items-start">
                            <input type="checkbox" name="framework_doctrine" value="true" class="checkbox checkbox-sm checkbox-primary rounded-xl mt-0.5" {% if framework and framework.doctrine %}checked{% endif %} aria-describedby="doctrine-description" />
                            <div class="flex-1 min-w-0">
                                <span class="label-text text-sm font-semibold text-base-content block mb-0.5">Doctrine</span>
                                <p id="doctrine-description" class="text-xs text-base-content/60 leading-relaxed">Core principles and operational doctrine for AI agents</p>
                            </div>
                        </label>
                        <label class="label cursor-pointer justify-start gap-3 items-start">
                            <input type="checkbox" name="framework_directives" value="true" class="checkbox checkbox-sm checkbox-primary rounded-xl mt-0.5" {% if framework and framework.directives %}checked{% endif %} aria-describedby="directives-description" />
                            <div class="flex-1 min-w-0">
                                <span class="label-text text-sm font-semibold text-base-content block mb-0.5">Directives</span>
                                <p id="directives-description" class="text-xs text-base-content/60 leading-relaxed">Communication guidelines and best practices</p>
                            </div>
                        </label>
                        <label class="label cursor-pointer justify-start gap-3 items-start">
                            <input type="checkbox" name="framework_playbooks" value="true" class="checkbox checkbox-sm checkbox-primary rounded-xl mt-0.5" {% if framework and framework.playbooks %}checked{% endif %} aria-describedby="playbooks-description" />
                            <div class="flex-1 min-w-0">
                                <span class="label-text text-sm font-semibold text-base-content block mb-0.5">Playbooks</span>
                                <p id="playbooks-description" class="text-xs text-base-content/60 leading-relaxed">Reusable workflow templates for common tasks</p>
                            </div>
                        </label>
                        <label class="label cursor-pointer justify-start gap-3 items-start">
                            <input type="checkbox" name="framework_enhancements" value="true" class="checkbox checkbox-sm checkbox-primary rounded-xl mt-0.5" {% if framework and framework.enhancements %}checked{% endif %} aria-describedby="enhancements-description" />
                            <div class="flex-1 min-w-0">
                                <span class="label-text text-sm font-semibold text-base-content block mb-0.5">Enhancements</span>
                                <p id="enhancements-description" class="text-xs text-base-content/60 leading-relaxed">Advanced features and optimizations (optional)</p>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </fieldset>

        {# Context Directory Section #}
        <fieldset class="relative flex flex-col h-full px-3 sm:px-4 py-3 sm:py-4 bg-base-200 shadow-sm border border-base-300 rounded-xl mb-3 sm:mb-4">
            <legend class="sr-only">Context Directory Configuration</legend>
            <div class="w-full">
                <h3 class="flex items-center gap-2 text-base sm:text-lg font-semibold mb-2 sm:mb-3 text-base-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                    </svg>
                    <span class="flex-1">Context Directory</span>
                    <button type="button" onclick="toggleInfo('context-info')" class="btn btn-circle btn-xs sm:btn-sm btn-ghost text-info hover:bg-info/10 tooltip tooltip-left flex items-center justify-center shrink-0 cursor-pointer" data-tip="More information about Context Directory" aria-label="Show more information about Context Directory" aria-expanded="false" aria-controls="context-info">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-4 h-4 sm:w-5 sm:h-5" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </button>
                </h3>

                <div id="context-info" class="mb-3 sm:mb-4 hidden" role="region" aria-labelledby="context-info-heading">
                    <h4 id="context-info-heading" class="text-sm sm:text-base font-semibold mb-2 text-base-content">What is a context directory?</h4>
                    <p class="text-xs sm:text-sm text-base-content/80 leading-relaxed mb-2">The context directory stores additional project documentation organized by topic. AI agents automatically read these files to understand your project better.</p>
                    <div class="bg-base-300/50 border border-base-300 rounded-lg p-2 sm:p-3 mt-2" role="note">
                        <p class="text-xs sm:text-sm font-semibold text-base-content mb-1">Best Practice:</p>
                        <p class="text-xs sm:text-sm text-base-content/80">Most projects don't need this. Start with everything in <code class="bg-base-200 px-1 py-0.5 rounded text-xs">config/standards.md</code>. Only create context files when your standards.md exceeds 1000 lines or you need better organization for team collaboration.</p>
                    </div>
                </div>

                <p class="text-xs sm:text-sm text-base-content/70 mb-3 sm:mb-4">If you create a context directory, it will be stored at <code class="bg-base-300 px-1 py-0.5 rounded text-xs sm:text-sm">config/context</code>. You can organize context files by topic (architecture.md, patterns.md, workflows.md, etc.) for better collaboration.</p>
                <div class="bg-base-300/50 border border-base-300 rounded-lg p-2 sm:p-3 mt-2" role="note">
                    <p class="text-xs sm:text-sm text-base-content/80"><strong>Note:</strong> The path is fixed to <code class="bg-base-200 px-1 py-0.5 rounded text-xs">config/context</code> for consistency. If you need a different location, you can change it manually in <code class="bg-base-200 px-1 py-0.5 rounded text-xs">config/standards.md</code> after setup.</p>
                </div>
                <input type="hidden" name="contextDir" value="config/context" />
            </div>
        </fieldset>

        {% set nextButtonLabel = 'Next: Review' %}
        {% set showBackButton = true %}
        {% include "partials/form-navigation.html" %}
    </form>
</div>
