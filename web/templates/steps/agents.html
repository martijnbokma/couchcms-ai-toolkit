<div>
    {% set sectionTitle = 'AI Agents' %}
    {% set sectionDescription = 'Select AI agents for specialized guidance. Agents matching your selected frontend frameworks are pre-selected.' %}
    {% include "partials/section-header.html" %}

    <form hx-post="/api/setup/step/agents" hx-target="#wizard-content" hx-swap="innerHTML">
        {% include "partials/hidden-fields.html" %}

        <!-- Recommended Agents Section -->
        {% if recommendedAgents and recommendedAgents|length > 0 %}
        <div class="alert alert-info mb-4 sm:mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-5 h-5 sm:w-6 sm:h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="text-xs sm:text-sm">
                <p class="font-semibold mb-1">Recommended Agents:</p>
                <p class="mb-2">Based on your frontend selections, we recommend these agents:</p>
                <div class="flex flex-wrap gap-2 mt-2">
                    {% for agent in recommendedAgents %}
                    <span class="badge badge-primary badge-sm text-xs">{{ agent }}</span>
                    {% endfor %}
                </div>
                <p class="text-xs mt-2 text-base-content/70">These agents are pre-selected for you. You can uncheck them if you don't need them.</p>
            </div>
        </div>
        {% endif %}

        {# Frontend Agents - Using unified option-selector component #}
        {% from "partials/option-selector.html" import optionSelector %}
        {% set frontendAgentOptions = agentOptions.frontend if agentOptions else [
            {id: 'tailwindcss', name: 'TailwindCSS Agent', description: 'Styling guidance with TailwindCSS'},
            {id: 'alpinejs', name: 'Alpine.js Agent', description: 'Reactive JavaScript patterns'},
            {id: 'javascript', name: 'JavaScript Agent', description: 'Modern JavaScript patterns'},
            {id: 'typescript', name: 'TypeScript Agent', description: 'Type-safe development'}
        ] %}
        {% set agentsSelected = agents|default([]) %}
        {{ optionSelector(
            frontendAgentOptions,
            'agents',
            'checkbox',
            agentsSelected,
            'Frontend Agents',
            'Agents for frontend frameworks and tools. Select agents that match your chosen frameworks.',
            '(optional)'
        ) }}

        {# Development Tools - Using unified option-selector component #}
        {% set devToolsOptions = agentOptions.devTools if agentOptions else [
            {id: 'bun', name: 'Bun Agent', description: 'Runtime and build tools'},
            {id: 'git', name: 'Git Agent', description: 'Version control workflows'},
            {id: 'mysql', name: 'MySQL Agent', description: 'Database operations'}
        ] %}
        {{ optionSelector(
            devToolsOptions,
            'agents',
            'checkbox',
            agentsSelected,
            'Development Tools',
            'Optional agents for development tools and workflows.',
            '(optional)'
        ) }}

        <div class="alert alert-info mb-4 sm:mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-5 h-5 sm:w-6 sm:h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="text-xs sm:text-sm">
                <p class="font-semibold">Note:</p>
                <p>All CouchCMS core agents are automatically included. You're only selecting optional frontend and development tool agents here.</p>
            </div>
        </div>

        {% set nextButtonLabel = 'Next: Editors' %}
        {% set showBackButton = true %}
        {% include "partials/form-navigation.html" %}
    </form>
</div>
